"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_code-view-shared_components_files-search_FileResultsList_tsx"],{28114:(e,t,r)=>{r.d(t,{V:()=>WebWorker});let WebWorker=class WebWorker{set onmessage(e){this.worker.onmessage=e}postMessage(e){this.worker.postMessage(e)}terminate(){this.worker.terminate()}constructor(e,t){try{this.worker=new Worker(e)}catch(e){console.warn("Web workers are not available. Please enable web workers to benefit from the improved performance."),this.worker=new MainThreadWorker(t)}}};let MainThreadWorker=class MainThreadWorker{async postMessage(e){if(this.terminated)return;let t={data:this.job({data:e})};this.onmessage?.(t)}terminate(){this.terminated=!0}constructor(e){this.job=e,this.terminated=!1}}},88947:(e,t,r)=>{r.r(t),r.d(t,{FileResultRow:()=>$,default:()=>M});var a=r(85893),s=r(211),l=r(86525),n=r(23180),i=r(79842),o=r(52674),c=r(15429),u=r(22326),d=r(77461),f=r(51952),h=r(85193),m=r(48542),x=r(13275),p=r(85529),g=r(17840),w=r(42483),b=r(51461),v=r(14786),y=r(73290),j=r(2708),R=r(74121),E=r(98833),C=r(97011),k=r(47142),S=r(67294),F=r(28114),L=r(15205);let N=(0,L.Z)(k.Gs);function I({data:e}){let{query:t,baseList:r,startTime:a}=e,s=t.replaceAll("\\",""),l=r.filter(e=>""===s||(0,k.CD)(s,e)&&N(s,e)>0).sort((e,t)=>N(s,t)-N(s,e));return{query:t,list:l,baseCount:r.length,startTime:a}}var Z=r(21573),A=r(87623);async function T(e){let t=await (0,A.v)(e);return t.ok?await t.json():void 0}let _=new Map,D=(0,L.Z)(T,{cache:_});function M({onRenderRow:e,onItemSelected:t,searchBoxRef:r,sx:d={},...p}){let{query:R,setQuery:E}=(0,s.aM)(),C=(0,o.H)(),k=S.useRef(null),L=r??k,[N,A]=S.useState(R.length>0),[T,_]=S.useState(!!R),{list:M,directories:$,loading:H,error:O}=function(e){let t=(0,o.H)(),{refInfo:r}=(0,l.Br)(),[a,s]=(0,S.useState)({list:[],directories:[],loading:!0}),n=(0,u.a_)({repo:t,commitOid:r.currentOid,includeDirectories:!0});return(0,S.useEffect)(()=>{let t=!1,r=async()=>{s({list:[],directories:[],loading:!0});let e=await D(n);if(t)return;let r=e?.paths||[],a=e?.directories||[],l=r.concat(a).sort();s({list:l,directories:a,error:!e})};return e&&r(),function(){t=!0}},[n,e]),a}(N),{path:B}=(0,l.Br)(),{findFileWorkerPath:G}=(0,l.Ou)(),{getUrl:V}=(0,i.B)(),{queryText:z,queryLine:P}=function(e){e=e.replaceAll(" ","");let t=e.indexOf(":");return t>=0?{queryText:e.substring(0,t),queryLine:parseInt(e.substring(t+1),10)}:{queryText:e,queryLine:void 0}}(R),{matches:K,clearMatches:U}=function(e,t,r,a){let[s,l]=S.useState(),i=S.useRef(""),o=S.useRef(),{sendStats:c}=(0,n.a)(),u=S.useRef(!1),d=S.useCallback(()=>{let e=new F.V(r,I);e.onmessage=({data:e})=>{u.current=!1,l(e.list),i.current=e.query,e.startTime&&c("repository.find-file",{"find-file-base-count":e.baseCount,"find-file-results-count":e.list.length,"find-file-duration-ms":performance.now()-e.startTime})},o.current=e},[c,r]);return S.useEffect(()=>{if(a)return d(),function(){o.current?.terminate()}},[d,a]),S.useEffect(()=>{if(e.length&&t){u.current&&(o.current?.terminate(),d());let r=i.current&&t.startsWith(i.current);u.current=!0,o.current?.postMessage({baseList:r&&s||e,query:t,startTime:performance.now()})}},[e,t,d]),{matches:s,clearMatches:()=>l(void 0)}}(M,z,G,N),{sendRepoClickEvent:Y}=(0,n.a)(),Q=(0,h.s)(),[X,J]=S.useState(0),[ee,et]=S.useState((0,Z.$)()),er=S.useRef(null),ea=S.useRef(null),es="file-results-list",{sendRepoKeyDownEvent:el}=(0,n.a)(),{screenSize:en}=(0,f.eI)(),ei=p.useOverlay||en>=f._G.large,eo=S.useCallback(()=>{Y("FILE_TREE.SEARCH_RESULT_CLICK"),t?.(),_(!1)},[Y,t]),{containerRef:ec}=(0,g.v)({bindKeys:m.Qw.ArrowVertical|m.Qw.HomeAndEnd,focusInStrategy:"previous"},[H,O]);S.useEffect(()=>{R||_(!1)},[R]),S.useEffect(()=>{document.activeElement!==L.current&&ei&&_(!1)},[B,L,ei]);let eu=K?.slice(0,40)||[],ed=K&&K.length>eu.length,ef=(0,a.jsx)(w.Z,{sx:{maxHeight:ei?"60vh":"100% !important",overflowY:"auto",scrollbarGutter:"stable",maxWidth:"100vw","@media (max-width: 768px)":{ml:3,mr:2}},children:O?(0,a.jsx)(b.Z,{variant:"danger",sx:{m:3},children:"Failed to search"}):(0,a.jsxs)(v.S,{ref:ec,sx:{overflow:"auto",p:ei?2:3,width:"100%",pr:ei?3:0,pt:ei?3:"2px !important"},role:"listbox",children:[!H&&eu.map((t,r)=>{let s=$.includes(t);return(0,a.jsx)(q,{active:t===B,index:r,focused:ee&&X===r,match:t,onRender:e,query:z,onClick:eo,isDirectory:s,to:V({path:t,action:s?"tree":"blob",hash:P?`L${P}`:""}),useOverlay:ei,listRef:ec},t)}),(0,a.jsxs)(w.Z,{sx:{m:3,textAlign:"center"},children:[(0,a.jsx)(W,{loading:H||!K,visibleResultCount:eu.length,truncated:!!ed}),ed&&(0,a.jsxs)(a.Fragment,{children:["\xa0",(0,a.jsx)(y.Z,{id:"see-all-results-link",className:"focus-visible",ref:er,href:(0,u.mY)({owner:C.ownerLogin,repo:C.name,searchTerm:`path:${z}`}),sx:ee&&X===eu.length?{outline:"2px solid var(--focus-outlineColor, var(--color-accent-fg))",outlineOffset:"-2px",boxShadow:"none"}:{},children:"See all results"})]})]})]})});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{ref:ea,sx:{mx:2,ml:3,...d},children:(0,a.jsx)(Z.f,{ariaActiveDescendant:(!ei&&R||ei&&T)&&ee&&X>-1?ed&&X===eu.length?"see-all-results-link":`file-result-${X}`:void 0,ariaExpanded:ei?T:void 0,ariaHasPopup:ei,ariaControls:ei?es:void 0,ref:L,query:R,onKeyDown:e=>{let{key:t,shiftKey:r,metaKey:a,altKey:s,ctrlKey:l}=e;if(!r&&!a&&!s){if("Escape"===t)R?(el("FILE_TREE.CANCEL_SEARCH"),E(""),U()):document.activeElement&&document.activeElement.blur();else if(!R)return;else if("Enter"===t)ed&&X===eu.length?Q((0,u.mY)({owner:C.ownerLogin,repo:C.name,searchTerm:`path:${z}`})):eu[X]&&(Q(V({path:eu[X],action:"blob",hash:P?`L${P}`:""})),_(!1));else if("ArrowDown"===t||l&&"n"===t){if(ed&&X>=eu.length-1){if(J(eu.length),er.current&&ec.current){let e=(0,c.M)(ec.current);(0,x.z)(er.current,e,{behavior:"instant"})}}else J(Math.min(X+1,eu.length-1));e.preventDefault();return}else if("ArrowUp"===t||l&&"p"===t){J(Math.max(X-1,0)),e.preventDefault();return}}},onPreload:()=>A(!0),onSearch:e=>{E(e),e?_(!0):(U(),_(!1)),J(0)},onBlur:e=>{ec.current?.contains(e.relatedTarget)||(_(!1),et(!1))},onFocus:()=>{R&&_(!0),et(!0)},sx:{minWidth:"160px"}})}),ei&&(0,a.jsx)(j.w,{anchorRef:ea,open:ei&&T,renderAnchor:null,onClose:()=>{_(!1)},focusZoneSettings:{disabled:!0},focusTrapSettings:{disabled:!0},width:"xlarge",align:"end",overlayProps:{id:es,role:"dialog"},children:ef}),!ei&&R&&ef]})}function W({visibleResultCount:e,truncated:t,loading:r}){return(0,a.jsx)("span",{role:"status",className:r||t||0===e?void 0:"sr-only","aria-label":r?"Loading":void 0,children:r?(0,a.jsx)(R.Z,{size:"large"}):0===e?"No matches found":t?`First ${e} files shown.`:`Showing ${e} files.`},"results-count-status")}let $=({active:e,focused:t,index:r,match:s,query:l,to:n,isDirectory:i,onClick:o,onRender:u,useOverlay:f,listRef:h})=>{let m=(0,k.m7)(l,s);u?.();let p=S.useRef(null),g=i?H:O;S.useEffect(()=>{if(t&&p.current&&h?.current){let e=(0,c.M)(h.current);(0,x.z)(p.current,e,{behavior:"instant"})}},[t,h]);let b={};return t&&(b={outline:"none",border:"2 solid",boxShadow:"0 0 0 2px #0969da"}),(0,a.jsx)(v.S.Item,{id:`file-result-${r}`,ref:p,as:d.r,onSelect:o,to:n,active:e,sx:{fontWeight:"normal",":hover":{textDecoration:"none"},mx:"2px",width:"calc(100% - 4px)",...b},role:"option","data-focus-visible-added":t||void 0,tabIndex:f?-1:0,children:(0,a.jsxs)(w.Z,{sx:{display:"flex"},children:[(0,a.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",flexGrow:1},children:(0,a.jsx)(B,{text:s,positionsList:m,sx:{color:"fg.muted"},LeadingIcon:g})}),t&&(0,a.jsx)(w.Z,{sx:{pl:1,whiteSpace:"nowrap",color:"fg.muted"},children:`Go to ${i?"folder":"file"}`})]})},s)},H=()=>(0,a.jsx)(E.Z,{"aria-label":"Directory",icon:p.FileDirectoryFillIcon,sx:{color:"var(--treeViewItem-leadingVisual-iconColor-rest, var(--color-icon-directory))",mr:2},size:"small"}),O=()=>(0,a.jsx)(E.Z,{"aria-label":"File",icon:p.FileIcon,sx:{color:"fg.muted",mr:2},size:"small"}),q=S.memo($);function B({text:e,positionsList:t,sx:r,LeadingIcon:s}){let l=[],n=0;for(let r of t){if(Number(r)!==r||r<n||r>e.length)continue;let t=e.slice(n,r);t&&l.push(G(t)),n=r+1,l.push((0,a.jsx)(C.Z,{as:"mark",sx:{fontWeight:"bold",background:"none",color:"fg.default"},children:e[r]},r))}return l.push(G(e.slice(n))),(0,a.jsx)(w.Z,{sx:r,children:(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(s,{}),l]})})}function G(e){return e.replaceAll("/","/\u200B")}try{M.displayName||(M.displayName="FileResultsList")}catch{}try{W.displayName||(W.displayName="FileResultsStatus")}catch{}try{$.displayName||($.displayName="FileResultRow")}catch{}try{H.displayName||(H.displayName="DirectoryIcon")}catch{}try{O.displayName||(O.displayName="FileResultIcon")}catch{}try{q.displayName||(q.displayName="MemoizedFileResultRow")}catch{}try{B.displayName||(B.displayName="HighlightMatch")}catch{}},21573:(e,t,r)=>{r.d(t,{$:()=>h,f:()=>f});var a=r(85893),s=r(46263),l=r(47357),n=r(23180),i=r(71207),o=r(85529),c=r(51526),u=r(42483),d=r(67294);let f=d.forwardRef(({ariaActiveDescendant:e,ariaControls:t,ariaExpanded:r,ariaHasPopup:i,onBlur:f,onFocus:m,onKeyDown:x,onPreload:p,onSearch:g,query:w,sx:b={}},v)=>{let{sendRepoClickEvent:y}=(0,n.a)(),[j,R]=d.useState(w),E=d.useRef((0,s.D)(e=>g(e),250));d.useEffect(()=>{R(w)},[w]);let C=w?(0,a.jsx)(c.Z.Action,{onClick:()=>{y("FILE_TREE.CANCEL_SEARCH"),g("")},icon:o.XCircleFillIcon,"aria-label":"Clear",sx:{color:"fg.subtle"}}):void 0;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(c.Z,{autoFocus:h(),ref:v,value:j,onKeyDown:x,onChange:e=>{R(e.target.value),p(),E.current(e.target.value)},sx:{display:"flex",...b},"aria-label":"Go to file","aria-activedescendant":e,role:i?"combobox":void 0,"aria-controls":t,"aria-expanded":r,"aria-haspopup":i?"dialog":void 0,autoCorrect:"off",spellCheck:"false",placeholder:"Go to file",leadingVisual:o.SearchIcon,trailingAction:C,trailingVisual:C?void 0:()=>(0,a.jsx)(l.I,{children:(0,a.jsx)(u.Z,{sx:{mr:"-6px"},children:(0,a.jsx)("kbd",{children:"t"})})}),onFocus:e=>{p(),e.target.select(),m?.(e)},onBlur:f,onClick:()=>y("FILE_TREE.SEARCH_BOX")})})});function h(){let e=new URLSearchParams(i.ssrSafeLocation.search);return"1"===e.get("search")}f.displayName="FilesSearchBox"}}]);
//# sourceMappingURL=ui_packages_code-view-shared_components_files-search_FileResultsList_tsx-2eb12340de53.js.map